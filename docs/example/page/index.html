<!DOCTYPE html>
<html lang="zh" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="一、发送模块 # 1.1、创建消息主题（即topic） # 发送方（producer）发消息到指定Topic之前，需要通过catMQ的portal创">
<meta name="theme-color" content="#FFFFFF">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="页面操作" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://iambiglee.github.io/docs/example/page/" />

<title>页面操作 | CatMQ Doc</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/zh.search.min.5120baef9ec46ecd678572e60c0fc0ce3f9f6f87298487a3151492791e77c363.js" integrity="sha256-USC6757Ebs1nhXLmDA/Azj&#43;fb4cphIejFRSSeR53w2M=" crossorigin="anonymous"></script>
<link rel="alternate" type="application/rss+xml" href="https://iambiglee.github.io/docs/example/page/index.xml" title="CatMQ Doc" />
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>CatMQ Doc</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="搜索" aria-label="搜索" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>



  



  
    
  



<ul class="book-languages">
  <li>
    <input type="checkbox" id="languages" class="toggle" />
    <label for="languages" class="flex justify-between">
      <a role="button" class="flex align-center">
        <img src="/svg/translate.svg" class="book-icon" alt="Languages" />
        Chinese
      </a>
    </label>

    <ul>
      
      <li>
        <a href="https://iambiglee.github.io/en/">
          English
        </a>
      </li>
      
    </ul>
  </li>
</ul>











  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/example/" class="">CatMQ项目文档</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/example/introduce/" class="">项目介绍</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/quickstart/" class="">快速开始</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/concept/" class="">基本概念</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-56d7034143b6129da38ab119e891d595" class="toggle"  />
    <label for="section-56d7034143b6129da38ab119e891d595" class="flex justify-between">
      <a href="/docs/example/design/" class="">详细设计</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/deployment/" class="">运维部属</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/develop/" class="">开发须知</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/functions/" class="">功能特性</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/example/page/" class="active">页面操作</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/docs/cv/" class="">个人介绍</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>页面操作</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#11创建消息主题即topic">1.1、创建消息主题（即topic）</a></li>
  </ul>

  <ul>
    <li><a href="#21创建消费者组即consumergroup">2.1、创建消费者组（即consumerGroup）</a></li>
    <li><a href="#22消费者组订阅管理即consumergroup和topic的订阅关系">2.2、消费者组订阅管理（即consumerGroup和topic的订阅关系）</a></li>
  </ul>

  <ul>
    <li><a href="#31-堆积统计">3.1 堆积统计</a></li>
    <li><a href="#32-数据统计">3.2 数据统计</a></li>
    <li><a href="#33-队列消费管理">3.3 队列消费管理</a></li>
    <li><a href="#34-队列管理">3.4 队列管理</a></li>
    <li><a href="#35-消息查询">3.5 消息查询</a></li>
    <li><a href="#36-日志查询">3.6 日志查询</a></li>
    <li><a href="#37-消费者查询">3.7 消费者查询</a></li>
    <li><a href="#38-队列报表">3.8 队列报表</a></li>
    <li><a href="#39-topic报表">3.9 topic报表</a></li>
    <li><a href="#310-物理机报表">3.10 物理机报表</a></li>
    <li><a href="#311-发送工具">3.11 发送工具</a></li>
  </ul>

  <ul>
    <li><a href="#41-数据节点管理">4.1 数据节点管理</a></li>
    <li><a href="#42-通知查询">4.2 通知查询</a></li>
    <li><a href="#43-lock">4.3 lock</a></li>
    <li><a href="#44-server">4.4 server</a></li>
    <li><a href="#45-mysql连接数">4.5 mysql连接数</a></li>
    <li><a href="#46-配置列表">4.6 配置列表</a></li>
    <li><a href="#47-元数据同步">4.7 元数据同步</a></li>
    <li><a href="#48-statistic">4.8 Statistic</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="一发送模块">
  一、发送模块
  <a class="anchor" href="#%e4%b8%80%e5%8f%91%e9%80%81%e6%a8%a1%e5%9d%97">#</a>
</h1>
<h2 id="11创建消息主题即topic">
  1.1、创建消息主题（即topic）
  <a class="anchor" href="#11%e5%88%9b%e5%bb%ba%e6%b6%88%e6%81%af%e4%b8%bb%e9%a2%98%e5%8d%b3topic">#</a>
</h2>
<p>发送方（producer）发消息到指定Topic之前，需要通过catMQ的portal创建该Topic，如果该Topic已存在则无须创建。下面演示一下如何创建Topic，和创建Topic时的注意事项：
<!-- raw HTML omitted -->
<img src="img.png" alt="img.png" /></p>
<p>点击最下方的“commit”按钮，完成topic的创建，进入如下页面：<!-- raw HTML omitted --> <img src="img_1.png" alt="img_1.png" /><!-- raw HTML omitted --><img src="img/createTopicResult.png#id=ES8KW&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" /></p>
<p>图中可以看到我们刚刚创建的topic：testtopic<br>
<img src="img_2.png" alt="img_2.png" />
点击每条记录最左侧的蓝色图标，可以查看该topic的操作记录。</p>
<p>创建topic的注意事项：</p>
<ol>
<li>Topic的名字不能以“_fail”结尾，因为系统以“_fail”结尾的Topic默认为存储失败消息的topic。</li>
<li>负责人为该Topic的负责人，可以多选。Topic负责人拥有的权限为：
<ul>
<li>编辑Topic的基本信息。</li>
<li>更改Topic中存储消息的保留天数。</li>
<li>生成和清除该Topic接收消息时的校验Token，修改Token时需慎重。</li>
<li>对该Topic进行扩容，自动扩容时受限于预期每日消息量。</li>
<li>对该Topic对应所有订阅的消费者产生的失败存储Topic的扩容以及更改保留天数。</li>
<li>删除该Topic，注意当存在消费者订阅该Topic的时候，不能删除。</li>
<li>可以在消息查询中查看该Topic中的消息发送的情况。</li>
</ul>
</li>
<li>堆积告警数默认10000，即当待处理消息达到10000时，会向发生堆积的订阅者 发送消息堆积告警。</li>
</ol>
<h1 id="二消费模块">
  二、消费模块
  <a class="anchor" href="#%e4%ba%8c%e6%b6%88%e8%b4%b9%e6%a8%a1%e5%9d%97">#</a>
</h1>
<h2 id="21创建消费者组即consumergroup">
  2.1、创建消费者组（即consumerGroup）
  <a class="anchor" href="#21%e5%88%9b%e5%bb%ba%e6%b6%88%e8%b4%b9%e8%80%85%e7%bb%84%e5%8d%b3consumergroup">#</a>
</h2>
<p>在“ConsumeGroup”页面，点击“create”按钮，进入“创建消费者组”页面：
<!-- raw HTML omitted --><img src="img_3.png" alt="img_3.png" />
<!-- raw HTML omitted --><img src="img_4.png" alt="img_4.png" /></p>
<p>注意事项：</p>
<ol>
<li>消费者组名字最好以ConsumerGroup结尾，便于识别。</li>
<li>消费者组负责人可以多选，负责人权限为：</li>
</ol>
<ul>
<li>编辑该消费者组的基本信息。</li>
<li>消费者组的订阅管理，主要是添加与topic的订阅关系。</li>
<li>强制刷新，刷新broker中内存的该消费者组的订阅关系，便于客户端获得最新的订阅关系。</li>
<li>删除该消费者组。</li>
<li>触发该消费者组的重平衡（即该消费者组下consumer实例的重新分配）。</li>
</ul>
<ol start="3">
<li>告警邮箱地址可以多个以英文逗号分隔，告警手机可以多个以英文逗号分隔。</li>
<li>消费机器数为消费的实例数，即启动的应用实例数，主要为了和消息系统2.0相对应。</li>
<li>黑白名单，为了限制哪些机器不可以消费和只可以哪些机器消费，只能选择其中一个。</li>
<li>是否告警，建议当机器消费实例启动后开启。</li>
<li>消息追踪，主要为了追踪消息在消费者中消费情况。</li>
<li>最大实例数用于设置消费者的最大数量，0表示不加限制。</li>
<li>消费模式：CatMQ有三种消费模式，分别是集群模式、广播模式、代理模式。</li>
</ol>
<ul>
<li>集群模式：CatMQ最常用的是集群模式（默认的模式）。consumerGroup订阅的topic下的队列会被均匀的分配到我们的消费端实例上（即多个消费端实例共同消费topic中的消息，每个消费端实例只能消费到topic的一部分消息）。</li>
<li>广播模式：每个消费端实例都可以消费到consumerGroup订阅的topic的所有消息（即consumerGroup下的每个消费端实例，都可以消费到全部的消息。并且每个消费端实例所消费的消息完全一样）。</li>
</ul>
<p>图中可以看到我们刚刚创建的消费者组：test1sub。</p>
<p>点击每条记录最左侧的蓝色图标，可以查看该consumerGroup的对应操作功能。</p>
<h2 id="22消费者组订阅管理即consumergroup和topic的订阅关系">
  2.2、消费者组订阅管理（即consumerGroup和topic的订阅关系）
  <a class="anchor" href="#22%e6%b6%88%e8%b4%b9%e8%80%85%e7%bb%84%e8%ae%a2%e9%98%85%e7%ae%a1%e7%90%86%e5%8d%b3consumergroup%e5%92%8ctopic%e7%9a%84%e8%ae%a2%e9%98%85%e5%85%b3%e7%b3%bb">#</a>
</h2>
<p>点击上图消费者组test1sub右侧的“订阅管理”按钮，进入到“TestConsumerGroup订阅管理”页面：</p>
<p><img src="img_5.png" alt="img_5.png" /><br>
<img src="img_6.png" alt="img_6.png" /><br>
在上图“主题名称”处选择test1sub想要订阅的topic：test1。选择配置参数后，其中注意事项如下：</p>
<ol>
<li>重试次数，作用于失败Topic，当消费失败的时候，消息会被发送到失败topic中，另外一个线程会去消费失败Topic中的消息，即进行失败消息的重试，重新消费成功则pass，否则继续重试直到达到最大重试次数。</li>
<li>线程数量，批量消费的线程数量，即同一个队列使用多少个线程去消费，线程数不能超过50。</li>
<li>告警阀值，当消息堆积达到该值时会发送告警邮件。</li>
<li>tag，值消息的标识，设置tag之后，消费者组只能消费这个Topic下带有该Tag的消息。</li>
<li>延迟时间（即延迟处理时间），以毫秒为单位，主要为了满足一些需要延迟去消费的场景，延迟时间最大为259200ms。</li>
<li>拉取条数，是指每次去向broker拉取多少条消息到客户端去消费，相当于一个本地缓存队列，然后本地线程去消费缓存队列里面的消息，批量拉取条数最大为500。</li>
<li>拉取等待时间，设置拉取线程的延迟等待时间。</li>
<li>消费熔断时间，即客户端处理消息的最大消耗时间。超过设置时间则熔断，单位秒,0表示不熔断。</li>
</ol>
<p>点击“添加订阅”完成订阅，当前页面下方会显示该消费者组订阅的所有Topic，同时也包含了订阅该Topic所产生的失败Topic，如下如所示：
<img src="img_7.png" alt="img_7.png" /></p>
<p>其中注意事项如下：</p>
<ol>
<li>其中失败Topic的命名规则为：ConsumerGroupName_TopicName_fail，当添加订阅的时候会创建该失败Topic并默认分配两个队列。（上图中test1sub_test1_fail就是test1sub订阅test1之后生成的失败topic，用于存储失败消息。）</li>
<li>批量拉取条数和批量消费条数需要加以区分，批量拉取条数是每次向broker拉取的条数（例如一次从broker拉取50条消息存储到本地队列），批量消费条数是指每个线程每次去消费的最大条数（例如：一次从本地队列中拿10条消息，做批量入库操作），故会存在，批量拉取条数&gt;=批量消费条数*线程数量</li>
<li>点击编辑按钮，可以设置该消费者订阅该Topic的重试次数、告警阀值、tag、延迟时间、线程数、批量拉取条数、批量消费条数、告警邮件等</li>
<li>点击“Unsubscribe”，解除消费者组和topic的订阅关系。</li>
<li>一个消费者组可以订阅多个topic，注意失败topic是自动生成的，不用单独订阅。</li>
</ol>
<h1 id="三管理模块">
  三、管理模块
  <a class="anchor" href="#%e4%b8%89%e7%ae%a1%e7%90%86%e6%a8%a1%e5%9d%97">#</a>
</h1>
<h2 id="31-堆积统计">
  3.1 堆积统计
  <a class="anchor" href="#31-%e5%a0%86%e7%a7%af%e7%bb%9f%e8%ae%a1">#</a>
</h2>
<p>CatMQ的portal，登陆之后默认展示“OverStockReport”页面：
<img src="img_8.png" alt="img_8.png" /></p>
<p>“堆积统计”页面，用于统计展示consumerGroup的消息堆积情况。</p>
<h2 id="32-数据统计">
  3.2 数据统计
  <a class="anchor" href="#32-%e6%95%b0%e6%8d%ae%e7%bb%9f%e8%ae%a1">#</a>
</h2>
<p>“DataReport”用于展示数据节点（即消息数据库节点）的信息。</p>
<p><img src="img_9.png" alt="img_9.png" />
<!-- raw HTML omitted -->注意：消息库中的一张表代表一个消息队列。上表的信息解读为，节点1是储存正常的消息，现在已经分配出去两个队列，还有198条队列没有分配出去</p>
<h2 id="33-队列消费管理">
  3.3 队列消费管理
  <a class="anchor" href="#33-%e9%98%9f%e5%88%97%e6%b6%88%e8%b4%b9%e7%ae%a1%e7%90%86">#</a>
</h2>
<p>“队列消费管理页面”用于展示consumerGroup对topic下每一个队列的消费情况，每一条记录对应着一个队列。</p>
<p><img src="img_10.png" alt="img_10.png" /></p>
<p>消费端实例（消费者）成功启动之后，消费端实例会订阅一个或者多个相关队列，参数说明如下：</p>
<ul>
<li>消费者：又叫消费端实例，根据重平衡策略，consumerGroup订阅的所有topic下的全部队列，会均匀分配给启动的消费端实例。</li>
<li>偏移量：是指当前队列中的消息，被消费到的位置。消息表（即队列）中的id是自增的，所以偏移量就是刚被消费的那条消息的id值。</li>
<li>待处理消息数：未被处理的消息数量，待处理消息数=队列中消息的最大id-当前偏移量。</li>
<li>读写类型：队列的读写类型分为读写和只读。类型为读写时，该队列既可以插入消息又可以消费消息。类型为只读时，该队列只能消费消息，不能插入。注意：这里需要保证一个Topic下至少存在一个可以读写的队列。点击旁边的白色按钮，即可进行读写类型的编辑。</li>
<li>消费标志：队列的消费标志分为正常消费和停止消费。正常消费顾名思义就是该队列的消息能够被正常消费，停止消费则表示该队列中的消息不能被消费，此时消费端不会去拉该队列中的消息。点击旁边的白色按钮，可以进行消费标志的编辑。</li>
<li>消息总数：队列（消息表）中的消息数量，因为我们会定时清理队列中过期的消息，所以消息总数=队列中消息的最大id-队列中消息的最小id，故会存在偏移量大于消息总数的情况。</li>
<li>起始偏移：是指该消费者组订阅该Topic时，该队列中消息的最大id。即消费者组开始消费消息时的位置。</li>
<li>最小id：该队列（消息表）中消息id最小的记录的id。</li>
<li>Topic类型：正常则为存储普通消息的Topic的队列，失败则为存储失败消息的队列，和存储类型对应。</li>
<li>分区id：该条记录对应的队列的id，可以在队列管理中查询到队列相关的信息。</li>
<li>存储类型：是指该队列的存储类型，一般我们使用失败类型的队列储存失败Topic中的消息，正常类型的队列存储正常类型Topic中的数据。</li>
<li>db节点：表示该队列对应于某个数据库中的某张表，消息都是存储在这个表中的，db节点=数据库的域名+数据库的库名+数据库的表名。</li>
<li>“偏移”按钮：管理员可以通过点击“偏移”按钮，来调整消费者在该队列中的消费位置。实时生效，谨慎操作。</li>
</ul>
<h2 id="34-队列管理">
  3.4 队列管理
  <a class="anchor" href="#34-%e9%98%9f%e5%88%97%e7%ae%a1%e7%90%86">#</a>
</h2>
<p>“队列管理”中的每一条记录，代表着一个队列即一张消息表。</p>
<p><img src="img_11.png" alt="img_11.png" /></p>
<p>每个队列对应消息数据库中的一张表，可以通过ip+库名+表名定位到具体的哪张表。</p>
<p>点击每条记录最左侧的蓝色图标，可以查看该queue的操作记录。</p>
<p>参数说明：</p>
<ul>
<li>队列编号：即该队列在queue表中的id。</li>
<li>数据节点编号：该队列（消息表）所属的数据库节点，在db_node表中的id。</li>
<li>ip: 该队列（消息表）所属数据库节点的域名数据库。</li>
<li>数据库名：该队列（消息表）所属数据库节点的名称。</li>
<li>表名：该队列（消息表）对应的表名称。</li>
<li>库状态：该队列（消息表）所属数据库节点的读写类型。读写表示该数据库既可以插入消息又可以拉取消息，只读表示该数据库只能拉取消息，不能插入。</li>
<li>topic：该队列被用于存储那个topic的消息。该字段为空表示:队列还未被分配。</li>
<li>存储类型：正常表示存储普通消息，失败表示存储处理失败的消息。</li>
<li>读写状态：读写表示该队列既可以插入消息，又可以拉取消息。只读表示该队列只能拉取消息，不能插入。</li>
<li>消息总数：队列（消息表）中的消息数量。</li>
<li>最小id：该队列（消息表）中消息id最小的记录的id。</li>
<li>“编辑”按钮：队列没有被分配时，该记录的最右侧可以看到“编辑”按钮，点击“编辑”可以为该队列分配topic。</li>
<li>“设为只读”：队列被分配给某个topic以后，右侧可以看到“设为只读”。点击该按钮可以把当前队列改为只读状态。</li>
<li>“移除”：队列被分配给某个topic以后，右侧可以看到“移除”。点击“移除”，会进入该topic的缩容页面。</li>
</ul>
<p>例如点击上图中的“移除”按钮，会进入topic：test1的缩容页面：
<img src="img_12.png" alt="img_12.png" /></p>
<p>例如：上图中topic：testtopic拥有两个队列，如果要对testtopic进行缩容，需要先对其中一个队列设置成只读。假设要缩容掉id为1的队列，步骤如下：</p>
<ul>
<li>点击id为1的队列右侧的“只读”按钮，把队列设为只读。</li>
<li>点击1右侧的“移除”按钮，完成test1对9173队列的缩容。</li>
</ul>
<h2 id="35-消息查询">
  3.5 消息查询
  <a class="anchor" href="#35-%e6%b6%88%e6%81%af%e6%9f%a5%e8%af%a2">#</a>
</h2>
<p>消息查询主要用于发送方和消费方查看消息，消息查询中具有权限控制：</p>
<ul>
<li>作为发送方只能查看到该用户负责的Topic的消息。</li>
<li>作为消费方只能查看到该用户所负责的消费者组中订阅的Topic里面的消息。</li>
</ul>
<p><img src="img_13.png" alt="img_13.png" /></p>
<ul>
<li>消息查询中可以查看正常类型的Topic的消息，也可以查看失败类型的Topic的消息</li>
<li>对于失败类型的Topic中的消息，如果想重新消费，先选择想要重新消费的消息，然后点击“批量重新发送”按钮，则失败消息会重新发送到失败类型的Topic中，便于该消费者重新消费。
<img src="img_14.png" alt="img_14.png" />
<img src="img/failMessageSearch.png#id=U8PvB&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" /></li>
</ul>
<h2 id="36-日志查询">
  3.6 日志查询
  <a class="anchor" href="#36-%e6%97%a5%e5%bf%97%e6%9f%a5%e8%af%a2">#</a>
</h2>
<p>日志查询页面，用于展示用户操作portal的审计日志：
<img src="img_15.png" alt="img_15.png" /></p>
<h2 id="37-消费者查询">
  3.7 消费者查询
  <a class="anchor" href="#37-%e6%b6%88%e8%b4%b9%e8%80%85%e6%9f%a5%e8%af%a2">#</a>
</h2>
<p>消费者查询页面，可以根据consumerGroup查询该consumerGroup下的consumer（即消费端实例）。
<!-- raw HTML omitted -->
<img src="img_16.png" alt="img_16.png" />
<!-- raw HTML omitted -->
消费者查询，主要用来查询该消费者组中启动成功的消费端实例：</p>
<ul>
<li>其中消费者实例=ip地址+进程号+随机数+端口号。</li>
<li>消费者实例会定期发送心跳给broker，没有心跳的消息者实例会被定时任务清理掉。</li>
</ul>
<h2 id="38-队列报表">
  3.8 队列报表
  <a class="anchor" href="#38-%e9%98%9f%e5%88%97%e6%8a%a5%e8%a1%a8">#</a>
</h2>
<p>队列报表，用于统计每个队列中的消息总量、平均每天的消息发送量。</p>
<p><img src="img_17.png" alt="img_17.png" /></p>
<p>图片左下角的“全部消息总量”为所有队列中的消息量的和。同理，“平均消息总量”为所有队列每天存入消息的平均值。</p>
<h2 id="39-topic报表">
  3.9 topic报表
  <a class="anchor" href="#39-topic%e6%8a%a5%e8%a1%a8">#</a>
</h2>
<p>topic报表，用于监控统计每个topic下的消息量（每个topic下有多个队列即消息表），以及topic下队列分配的合理性。页面如下图所示：</p>
<p><img src="img_18.png" alt="img_18.png" /></p>
<p>字段说明：</p>
<ul>
<li>消息总量：该topic下所有队列，存储的消息量总和。</li>
<li>实际每日消息量：该topic每天存入的消息量。</li>
<li>每个队列平均每日消息量：topic下每个队列每天存入的消息量。</li>
<li>队列治理：我们根据topic和topic下每个队列的消息总量以及平均消息量，对topic的队列分配数量进行监控统计，分析队列分配的合理性。如果平均消息量过多，会给出“应该扩容”的建议。如果消息量过少，会给出“应该缩容”的建议。</li>
<li>队列数量治理：队列治理的具体值，例如-1表示应该缩容掉一个队列（即减少一个队列），2表示应该扩容两个队列（即增加两个队列），0表示队列分配合理。</li>
<li>操作区：如果topic需要缩容，右侧会展示“缩容”按钮，点击缩容会进入该topic的缩容页面。同理如果topic需要扩容，右侧会展示“扩容”按钮</li>
</ul>
<h2 id="310-物理机报表">
  3.10 物理机报表
  <a class="anchor" href="#310-%e7%89%a9%e7%90%86%e6%9c%ba%e6%8a%a5%e8%a1%a8">#</a>
</h2>
<p>物理机报表，用于统计展示每台消息库物理机的消息总量、平均每天入库的消息量。
<img src="img_19.png" alt="img_19.png" /></p>
<p><img src="img/dbIpReport.png#id=dFpub&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" /></p>
<h2 id="311-发送工具">
  3.11 发送工具
  <a class="anchor" href="#311-%e5%8f%91%e9%80%81%e5%b7%a5%e5%85%b7">#</a>
</h2>
<p>为了方便测试人员，我们开发了一个消息发送页面。通过“Simulation Tools”页面，可以简单的实现消息的发送。
<img src="img_20.png" alt="img_20.png" /></p>
<p><img src="img/messageTool.png#id=GR5dP&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" /></p>
<h1 id="四系统管理员模块">
  四、系统管理员模块
  <a class="anchor" href="#%e5%9b%9b%e7%b3%bb%e7%bb%9f%e7%ae%a1%e7%90%86%e5%91%98%e6%a8%a1%e5%9d%97">#</a>
</h1>
<p>注意：以下页面仅对系统管理员展示。</p>
<h2 id="41-数据节点管理">
  4.1 数据节点管理
  <a class="anchor" href="#41-%e6%95%b0%e6%8d%ae%e8%8a%82%e7%82%b9%e7%ae%a1%e7%90%86">#</a>
</h2>
<p>数据节点管理，用于消息库节点的创建、编辑、以及创建消息表与元数据库mq_basic中的queue表的对应关系。</p>
<p><img src="img_21.png" alt="img_21.png" /></p>
<p>点击“创建”按钮，弹出创建节点的弹框，创建节点时需要注意：</p>
<ul>
<li>主库ip和从库ip不能一样。</li>
<li>读写状态：默认为可读可写，表示数据库可以插入也可以查询。</li>
<li>存储类型：选择“正常队列消息”表示该库用于存储普通消息，选择“失败队列消息”表示该库用于存储处理失败的消息。</li>
</ul>
<p>“批量对比”按钮，用于为所有库节点的消息表创建与queue的对应关系。</p>
<p>右侧操作区按钮说明：</p>
<ul>
<li>编辑：点击“编辑”按钮，可以修改消息库节点的信息。</li>
<li>生成sql:生成创建表的sql语句。</li>
<li>对比：为当前消息库节点的消息表创建与queue的对应关系。</li>
<li>分析：查看该消息库节点下topic的分布情况。</li>
<li>更改状态：修改当前节点的读写状态。</li>
<li>生成insert：生成插入消息库节点记录的sql语句样例（把节点记录插入db_node库中的语句）。</li>
</ul>
<h2 id="42-通知查询">
  4.2 通知查询
  <a class="anchor" href="#42-%e9%80%9a%e7%9f%a5%e6%9f%a5%e8%af%a2">#</a>
</h2>
<p>通知查询，用于展示重平衡请求记录的信息（表中的每一条记录表示一个重平衡请求），以及重平衡器当前处理到的位置（即重平衡器处理到了第几条请求）。</p>
<p><img src="img_22.png" alt="img_22.png" /></p>
<p>通知查询页面包含两张表，图中蓝色标注的表格记录“重平衡器”当前处理到第几条“重平衡请求”（即重平衡器的处理位点）。图中红色标注的表格记录所有重平衡请求（每一条记录都是一个重平衡请求），记录中的消费者组Id就是触发重平衡的consumerGroup的id。</p>
<h2 id="43-lock">
  4.3 lock
  <a class="anchor" href="#43-lock">#</a>
</h2>
<p>CatMQ中有一些定时器，lock页面用于展示定时器与portal实例的对应关系（定时器会被portal实例抢占执行，如果定时器A被portal实例1抢占了，其他的portal实例则抢占不到定时器A了。）</p>
<p><img src="img_23.png" alt="img_23.png" /></p>
<p>上图中ip表示的是portal实例的IP地址，key1表示的是不同定时器的名字，具体含义如下：</p>
<ul>
<li>mq_auditlog_clean_sk：操作日志清理定时器。</li>
<li>mq_message_clean_sk：消息清理定时器。</li>
<li>mq_noSubscribe_sk：未订阅检查定时器。</li>
<li>mq_redundance_check_sk：冗余检查定时器。</li>
<li>mq_NoActiveConsumer_sk：服务端心跳异常检测定时器（检测心跳异常的客户端）。</li>
<li>mq_queueExpansion_sk：队列空间检查定时器。</li>
<li>mq_notify_clean_sk：清理重平衡请求和缓存更新请求的定时器。</li>
<li>mq_messageLagN_sk：消息堆积检查定时器。</li>
<li>mq_rb_sk：重平衡检查定时器。</li>
</ul>
<h2 id="44-server">
  4.4 server
  <a class="anchor" href="#44-server">#</a>
</h2>
<p>server展示的是broker服务端的实例列表。CatMQ的客户端可以通过两种方式去连接broker服务端，第一种是通过域名的方式（通过nginx）,第二种是通过ip直连的方式（客户端会定时拉取broker服务端实例的ip列表，通过ip地址直接访问）。<!-- raw HTML omitted --><img src="img/server.png#id=tmAMS&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" /><!-- raw HTML omitted -->注意：通过ip直连时，需要在server列表中，把可以被访问的broker服务端实例的statusFlag状态位打开（即允许该broker实例接入流量）。</p>
<p><img src="img_24.png" alt="img_24.png" /></p>
<p>CatMQ默认采用ip直连的方式（记得去server列表中打开statusFlag状态位）。CatMQ通过配置的方式来实现域名访问和ip直连方式的切换。具体方式如下：</p>
<ul>
<li>CatMQ的客户端和服务端分别有一个配置项，都叫做mq.broker.metaMode。</li>
<li>服务端的mq.broker.metaMode默认值为1，表示强制指定为ip直连的方式（此时客户端的mq.broker.metaMode的配置失效）。</li>
<li>如果服务端的mq.broker.metaMode的值设置为-1，表示强制指定为域名访问的方式（此时客户端的mq.broker.metaMode的配置失效）。</li>
<li>如果服务端的mq.broker.metaMode的值设置为0，表示根据客户端的mq.broker.metaMode配置决定访问方式：
<ul>
<li>客户端的mq.broker.metaMode值默认为true，表示使用ip直连的访问方式。</li>
<li>如果客户端的mq.broker.metaMode值为false，表示使用域名访问的方式。</li>
</ul>
</li>
</ul>
<p>注意：只有服务端的mq.broker.metaMode值为0时，客户端的mq.broker.metaMode配置才会生效。</p>
<p>特表说明：发布时为了防止抖动，需要先将待发布的服务端实例关闭，默认30秒同步到客户端，发布完成打开statusFlag状态位。</p>
<h2 id="45-mysql连接数">
  4.5 mysql连接数
  <a class="anchor" href="#45-mysql%e8%bf%9e%e6%8e%a5%e6%95%b0">#</a>
</h2>
<p>该页面用于展示CatMQ的元数据库和消息库所在物理机的连接数，如下所示：</p>
<p><img src="img_25.png" alt="img_25.png" /></p>
<p>上图中物理机表示的是元数据库和消息库的域名。</p>
<h2 id="46-配置列表">
  4.6 配置列表
  <a class="anchor" href="#46-%e9%85%8d%e7%bd%ae%e5%88%97%e8%a1%a8">#</a>
</h2>
<p>配置列表，用于展示配置类soaConfig中所有配置的名称、默认值、当前值、以及配置说明，如下图所示：</p>
<p><img src="img_26.png" alt="img_26.png" /></p>
<h2 id="47-元数据同步">
  4.7 元数据同步
  <a class="anchor" href="#47-%e5%85%83%e6%95%b0%e6%8d%ae%e5%90%8c%e6%ad%a5">#</a>
</h2>
<p>元数据同步页面，用于多个环境之间同步topic、consumerGroup、以及订阅关系（即consumerGroup订阅了那几个topic）。</p>
<p><img src="img_27.png" alt="img_27.png" /><img src="img/syn.png#id=lzPt1&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt="" /></p>
<p><!-- raw HTML omitted -->具体步骤如下：<!-- raw HTML omitted -->假设我们要把fat环境的元数据同步到uat环境</p>
<ul>
<li>同步topic：
<ul>
<li>首先进入fat环境的“元数据同步”页面，在“请选择同步类型”处选择“同步topic”。</li>
<li>点击生成按钮，fat的界面上会生产成所有topic的json串，复制生成的json串。</li>
<li>然后进入uat环境的“元数据同步”页面，在“请选择同步类型”处选择“同步topic”。把上一步复制的json串，粘贴到uat的文本区域。</li>
<li>点击uat环境中的“同步”按钮，则开始同步。同步完成时会有提示（由于批量同步量比较大，同步过程需要点时间）。</li>
</ul>
</li>
<li>同步consumerGroup：
<ul>
<li>首先进入fat环境的“元数据同步”页面，在“请选择同步类型”处选择“同步consumerGroup”。</li>
<li>点击生成按钮，fat的界面上会生产成所有consumerGroup的json串，复制生成的json串。</li>
<li>然后进入uat环境的“元数据同步”页面，在“请选择同步类型”处选择“同步consumerGroup”。把上一步复制的json串，粘贴到uat的文本区域。</li>
<li>点击uat环境中的“同步”按钮，则开始同步。同步完成时会有提示（由于批量同步量比较大，同步过程需要点时间）。</li>
</ul>
</li>
<li>同步订阅关系：
<ul>
<li>首先进入fat环境的“元数据同步”页面，在“请选择同步类型”处选择“同步订阅关系”。</li>
<li>点击生成按钮，fat的界面上会生产成所有订阅关系的json串，复制生成的json串。</li>
<li>然后进入uat环境的“元数据同步”页面，在“请选择同步类型”处选择“同步订阅关系”。把上一步复制的json串，粘贴到uat的文本区域。</li>
<li>点击uat环境中的“同步”按钮，则开始同步。同步完成时会有提示（由于批量同步量比较大，同步过程需要点时间）。</li>
</ul>
</li>
</ul>
<h2 id="48-statistic">
  4.8 Statistic
  <a class="anchor" href="#48-statistic">#</a>
</h2>
<p>队列统计report,可以根据实际数据去统计各个使用部门的消息总量的Report。
<img src="img_28.png" alt="img_28.png" /></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#11创建消息主题即topic">1.1、创建消息主题（即topic）</a></li>
  </ul>

  <ul>
    <li><a href="#21创建消费者组即consumergroup">2.1、创建消费者组（即consumerGroup）</a></li>
    <li><a href="#22消费者组订阅管理即consumergroup和topic的订阅关系">2.2、消费者组订阅管理（即consumerGroup和topic的订阅关系）</a></li>
  </ul>

  <ul>
    <li><a href="#31-堆积统计">3.1 堆积统计</a></li>
    <li><a href="#32-数据统计">3.2 数据统计</a></li>
    <li><a href="#33-队列消费管理">3.3 队列消费管理</a></li>
    <li><a href="#34-队列管理">3.4 队列管理</a></li>
    <li><a href="#35-消息查询">3.5 消息查询</a></li>
    <li><a href="#36-日志查询">3.6 日志查询</a></li>
    <li><a href="#37-消费者查询">3.7 消费者查询</a></li>
    <li><a href="#38-队列报表">3.8 队列报表</a></li>
    <li><a href="#39-topic报表">3.9 topic报表</a></li>
    <li><a href="#310-物理机报表">3.10 物理机报表</a></li>
    <li><a href="#311-发送工具">3.11 发送工具</a></li>
  </ul>

  <ul>
    <li><a href="#41-数据节点管理">4.1 数据节点管理</a></li>
    <li><a href="#42-通知查询">4.2 通知查询</a></li>
    <li><a href="#43-lock">4.3 lock</a></li>
    <li><a href="#44-server">4.4 server</a></li>
    <li><a href="#45-mysql连接数">4.5 mysql连接数</a></li>
    <li><a href="#46-配置列表">4.6 配置列表</a></li>
    <li><a href="#47-元数据同步">4.7 元数据同步</a></li>
    <li><a href="#48-statistic">4.8 Statistic</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












